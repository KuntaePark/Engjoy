<!DOCTYPE html>
<html lang="ko"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security"
      layout:decorate="~{fragment/default}">

<th:block layout:fragment="css">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/cal-heatmap/dist/cal-heatmap.css">
    <style>
        /* ì—°ë„ ì„¸ë¡œ ì •ë ¬ */
        .year-labels {
            display: flex;
            flex-direction: column;
            justify-content: flex-start;
            padding-right: 12px;
            color: #4b5563; /* Tailwind gray-600 */
            font-size: 14px;
        }
        .year-labels > div {
            writing-mode: vertical-rl;
            transform: rotate(180deg);
            margin-bottom: 20px;
            user-select: none;
        }

        /* ìš”ì¼ í‘œì‹œ */
        .weekday-labels {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            text-align: center;
            font-size: 12px;
            color: #4b5563; /* Tailwind gray-600 */
            margin-bottom: 6px;
            user-select: none;
        }

        /* cal-heatmap ê¸°ë³¸ í°íŠ¸ í¬ê¸° ì¡°ì ˆ */
        #cal-heatmap .ch-month, #cal-heatmap .ch-day {
            font-size: 10px;
        }

        /* Tooltip ìŠ¤íƒ€ì¼ (ì„ íƒ ì‚¬í•­) */
        .ch-tooltip {
            padding: 4px 8px;
            background-color: #333;
            color: #fff;
            border-radius: 4px;
            font-size: 12px;
        }

        #cal-heatmap rect.ch-subdomain-bg[data-date$="-01"] {
          stroke: #4b5563 !important;
          stroke-width: 1px !important;
        }


    </style>
</th:block>
<th:block layout:fragment="script">
    <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/wa0x6e/cal-heatmap/dist/cal-heatmap.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="https://cdn.jsdelivr.net/gh/wa0x6e/cal-heatmap/dist/plugins/Tooltip.min.js"></script>
    <script src="https://d3js.org/d3.v7.min.js"></script>

    <script th:inline="javascript">
        document.addEventListener('DOMContentLoaded', () => {
            const reportData = /*[[${report}]]*/ null;

            if (reportData && reportData.dailyLearningCounts) {
                const heatmapData = Object.entries(reportData.dailyLearningCounts).map(([dateStr, count]) => {
                    return {
                        date: dateStr,
                        value: count > 0 ? 1 : 0
                    };
                });

                const cal = new CalHeatmap();
                cal.paint({
                    data: {
                        source: heatmapData,
                        x: 'date',
                        y: 'value'
                    },
                    date: { start: new Date(new Date().setMonth(new Date().getMonth() - 11)) },
                    range: 12,
                    scale: {
                        color: {
                            type: 'threshold',
                            domain: [1],
                            range: ['#eee', '#34d399']
                        }
                    },
                    domain: { type: 'month' },
                    subDomain: { type: 'ghDay', radius: 2, width: 11, height: 11 },
                    itemSelector: '#cal-heatmap'
                },
                [
                    [Tooltip, {
                        text: function (date, value, dayjsDate) {
                            return dayjsDate.format('YYYY-MM-DD');
                        }
                    }]
                ]);
            }

        });
    </script>
</th:block>

<th:block layout:fragment="main">
    <div class="container mx-auto p-6">
        <h1 class="text-2xl font-bold mb-4">ğŸ“˜ í•™ìŠµ ë¦¬í¬íŠ¸</h1>

        <div class="grid grid-cols-3 gap-4 mb-6">
            <div class="p-4 bg-blue-100 rounded">
                ì£¼ê°„ ë³µìŠµ ìˆ˜<br><strong id="weekly-review-count" th:text="${report.weekReviews}">0</strong>
            </div>
            <div class="p-4 bg-red-100 rounded">
                ì˜¤ë‹µ ìˆ˜<br><strong id="incorrect-count" th:text="${report.weekIncorrects}">0</strong>
            </div>
        </div>

        <section class="mt-10">
            <h2 class="text-xl font-semibold mb-4">ğŸ“… ì¼ë³„ í•™ìŠµ íˆíŠ¸ë§µ</h2>

            <div style="display: flex; align-items: flex-start;">
                <div style="writing-mode: vertical-rl;transform: rotate(180deg);font-size: 30px;line-height: 11px; height: 77px; /* 11px * 7ì¤„ */
                color: #4b5563; margin-right: 20px; user-select: none;">
                    <span th:text="${#dates.format(new java.util.Date(), 'yyyy')}"></span>
                </div>

                <div>
                    <div style="display: flex; flex-direction: column; justify-content: space-between; height: 77px; /* 11px * 7ì¤„ */
                        font-size: 9px; color: #4b5563; margin-right: 8px; width: 14px; user-select: none; flex-shrink: 0; ">
                        <div>S</div><div>M</div><div>T</div><div>W</div><div>T</div><div>F</div><div>S</div>
                    </div>
                </div>

                <div id="cal-heatmap" style="margin-left:2px; flex-grow:1;"></div>
            </div>
        </section>
    </div>
</th:block>
</html>